---
title: "DataViz"
author: "Kevin S.W."
date: "9/26/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message, FALSE)

Packages <- c("tidyverse", "ggridges", "hexbin")
invisible(lapply(Packages, library, character.only = TRUE))

```

# Data Viz 1
Creating ggplot from weather data from NOAA

## Loading weather data

```{r weather_data, cache = TRUE}

# Package interfaces with the weather station/service; interacts with NOAA servers and downloads the updated data
weather_df = 
  rnoaa::meteo_pull_monitors(c("USW00094728", "USC00519397", "USS0023B17S"), # Stations to download from
                      var = c("PRCP", "TMIN", "TMAX"), # which variables i want
                      date_min = "2017-01-01",     #range of dates min - max
                      date_max = "2017-12-31") %>%
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY", 
                      USC00519397 = "Waikiki_HA",
                      USS0023B17S = "Waterhole_WA"),
    tmin = tmin / 10,
    tmax = tmax / 10) %>%
  select(name, id, everything())

weather_df

```

## creating ggplot
```{r}

ggplot(weather_df, aes(x = tmin, y = tmax)) +
  geom_point()

# alternative way to make the plot:
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point()

#saving initial plots
weather_df %>% filter(name == "CentralPark_NY") #without any variable assignments, this code will "print out" immediately.

# if we want to save instead, we can assign a variable to it. i.e.
scatter = weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point()

scatter
```

## Adding color to plot

```{r}

# Aesthetic maps can be added inside each "assignments" or just do it outside
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = 0.4)
  

```

## why does aes() positions matter?

```{r}

# if we add geom_smooth at the end...
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_point(aes(color = name), alpha = 0.4) +
  geom_smooth(se = FALSE) # se = FALSE removes the "error bars" of the line plot


# if we move the aes up to ggplot...
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(aes(alpha = 0.4)) +
  geom_smooth(se = FALSE) 

```

by adding aes() inside the geom_point(), it only "applies" to those variables. If we put it into ggplot however, it will apply to everything.

## facets!
manipulating the data presentation beyond 1 graph
```{r}

weather_df %>% 
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(aes(alpha = 0.4)) +
  geom_smooth(se = FALSE) +
  facet_grid(~name) # the thing on the right side of the tilde, will be columns

```

## lets do more plotting
```{r}

# we can see temp changes over time
weather_df %>% 
  ggplot(aes(x = date, y = tmax, color = name)) +
  geom_point(aes(size = tmax), alpha = 0.3) +  # adding size = prcp into point changes the sizes based on the "intensity".
  geom_smooth(se = FALSE)

# or if we want to see precip
weather_df %>% 
  ggplot(aes(x = date, y = prcp, color = name)) +
  geom_point() +  
  geom_smooth(se = FALSE)

```

## Some extra stuff

```{r}

weather_df %>% 
  ggplot(aes(x = date, y = tmax, color = name)) +
  geom_point(aes(size = tmax), alpha = 0.3) +  
  geom_smooth(size = 2, se = FALSE)

```


## 2d density
```{r}
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax)) +
  geom_hex()
  
```

## more plots

```{r}

## Examples of univariate plots (only x variable)

# color actually only colors the "outlines".
# so we need to use "fill ="
weather_df %>% 
  ggplot(aes(x = tmax, fill = name)) +  
  geom_histogram(position = "dodge") #adding position = "dodge" allows the bars next to each other

# alternatively
weather_df %>% 
  ggplot(aes(x = tmax, fill = name)) +  
  geom_histogram() +
  facet_grid(~name)

#density plot...
weather_df %>% 
  ggplot(aes(x = tmax, fill = name)) +  
  geom_density(alpha = 0.3)

# boxplots
weather_df %>% 
  ggplot(aes(x = name, y = tmax)) +  
  geom_boxplot()

# violin plots; usually you can see a "density" plot if you turn your head sideways
weather_df %>% 
  ggplot(aes(x = name, y = tmax)) +  
  geom_violin()

# ridge plots; useful when you have "lots" of datapoints
weather_df %>% 
  ggplot(aes(x = tmax, y = name)) +  
  geom_density_ridges() # in ggridges

```

# saving plots
```{r}

# to save a plot; assign a name to it
gg_ridge = 
  weather_df %>% 
  ggplot(aes(x = tmax, y = name)) +  
  geom_density_ridges() # in ggridges

# format is (filename; ie location of file, which plot). if location not specified, will be local folder
ggsave("ggplot_temp_ridge.pdf", gg_ridge) 

# possible to do ggsave() as it assumes the last plot...but this is dangerous practice.

```

# regarding boxplots and figure dimensions in RMarkdown

when specifying in the chunk the figure width (fig.width = ...) this sets the boundaries of the graph. The larger it is, the wider the boundaries.

```{r, fig.width = 6}
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(aes(alpha = 0.4)) + 
  geom_smooth(se = FALSE)

```

```{r, fig.width = 12}
weather_df %>% 
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(aes(alpha = 0.4)) +
  geom_smooth(se = FALSE)

```

# Data Viz II - ggplot more in depth

```{r weather_data2, cache = TRUE}

#caching saves the output into a certain code chunk...it's like "RAM". 

weather_df = 
  rnoaa::meteo_pull_monitors(c("USW00094728", "USC00519397", "USS0023B17S"), # Stations to download from
                      var = c("PRCP", "TMIN", "TMAX"), # which variables i want
                      date_min = "2017-01-01",     #range of dates min - max
                      date_max = "2017-12-31") %>%
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY", 
                      USC00519397 = "Waikiki_HA",
                      USS0023B17S = "Waterhole_WA"),
    tmin = tmin / 10,
    tmax = tmax / 10) %>%
  select(name, id, everything())

weather_df

```

## making new plots

start with an old plot

```{r}

weather_df %>% 
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(alpha = .5)

```

then we add labels using labs()...

```{r}

weather_df %>% 
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(alpha = .5) +
  labs(
    title = "Temp plot",
    x = "min temp in C",
    y = "max temp in C",
    caption = "data from NOAA via rnoaa package"
  )

```

then we can adjust its scales. The form is scale_*  , such as x-axis tick marks, etc

```{r}

weather_df %>% 
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(alpha = .5) +
  labs(
    title = "Temp plot",
    x = "min temp in C",
    y = "max temp in C",
    caption = "data from NOAA via rnoaa package") +
  scale_x_continuous(
    breaks = c(-15,-5,20),   # x-axis "tick marks" (the guide ticks)
    labels = c("-15C", "-5", "-20")) +  # to change those specific "labels"
# transforms datapoint to be the "sqrt" of each points. alternatively you can have scale_y_sqrt()
   scale_y_continuous(
    trans = "sqrt")

```

## Colors!!

Setting your own hues...
```{r}

weather_df %>% 
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(alpha = .5) +
  labs(
    title = "Temp plot",
    x = "min temp in C",
    y = "max temp in C",
    caption = "data from NOAA via rnoaa package") +
  scale_color_hue(          # this is setting the hues of the color yourself
    name = "Location",
    h = c(50, 200)           # range of the hue to take
  )
  
```

Or we can use `viridis` package.
This is super useful because the gradients in the package are made with color-blindness and grayscales in mind (they still retain the gradient).

```{r}

gg_base <- weather_df %>%    # making a baseline plot
  ggplot(aes(x = tmin, y = tmax, color = name)) + 
  geom_point(alpha = .5) +
  labs(
    title = "Temp plot",
    x = "min temp in C",
    y = "max temp in C",
    caption = "data from NOAA via rnoaa package") +
  viridis::scale_color_viridis(
    name = "Location",
    discrete = TRUE
  )
```

## Themes...
themes() are "global" things that deal with the general things of the plot. Typically organizations

```{r}

gg_base +
  theme(
    legend.position = "bottom"    # replaces the position of the legend
  )

```

We can change the theme_*...such as theme_bw()

```{r}
gg_base +
  theme_bw()+
  theme(legend.position = "bottom")
```

or theme_minimal()...

NOTE: in ggplot, ORDER MATTERS!! i.e. applying general "themes" later will "reset" whatever granular modifications you did since it overrides prior commands.

Themes are recommended to be applied first before adjusting anything else. Check `ggthemes` for more themes.

```{r}

gg_base +
  theme_minimal() +
  theme(legend.position = "none")

```


you can add the code below at the top along with the initial code chunk in order to set it globally

```{r}

theme_set(theme_bw() + theme(legend.position = "bottom"))

```

